# ‚úÖ –£–ª—É—á—à–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ Polling –¥–ª—è Render

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è polling –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –Ω–∞ Render.

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Bot (—Å—Ç—Ä–æ–∫–∞ ~79)

**–ë—ã–ª–æ:**
```python
bot = Bot(token=BOT_TOKEN)
```

**–°—Ç–∞–ª–æ:**
```python
bot = Bot(
    token=BOT_TOKEN,
    session_timeout=30  # –ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è HTTP —Å–µ—Å—Å–∏–∏
)
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Polling (—Å—Ç—Ä–æ–∫–∞ ~1950)

**–ë—ã–ª–æ:**
```python
dp.start_polling(
    bot,
    allowed_updates=dp.resolve_used_update_types(),
    close_bot_session=False,
    drop_pending_updates=True
)
```

**–°—Ç–∞–ª–æ:**
```python
polling_timeout = 60  # 60 —Å–µ–∫—É–Ω–¥ - –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è Render
polling_limit = 100   # –ú–∞–∫—Å–∏–º—É–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∑–∞ –∑–∞–ø—Ä–æ—Å

dp.start_polling(
    bot,
    polling_timeout=polling_timeout,  # –¢–∞–π–º–∞—É—Ç –¥–ª—è long polling
    limit=polling_limit,              # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∑–∞ –∑–∞–ø—Ä–æ—Å
    allowed_updates=dp.resolve_used_update_types(),
    close_bot_session=False,
    drop_pending_updates=True
)
```

### 3. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã polling
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Render
- –°—Ç–∞—Ç—É—Å health check

---

## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `polling_timeout` | **60 —Å–µ–∫** | –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram (long polling) |
| `polling_limit` | **100** | –ú–∞–∫—Å–∏–º—É–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å |
| `session_timeout` | **30 —Å–µ–∫** | –ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è HTTP –∫–ª–∏–µ–Ω—Ç–∞ |
| `no_updates_timeout` | **300 —Å–µ–∫** (5 –º–∏–Ω) | –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π |
| `preventive_restart_interval` | **21600 —Å–µ–∫** (6 —á) | –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ |

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞ Render:**
   - Long polling —Å —Ç–∞–π–º–∞—É—Ç–æ–º 60 —Å–µ–∫—É–Ω–¥ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —á–∞—Å—Ç—ã–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏
   - –ú–µ–Ω—å—à–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ = –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Render

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–∏ polling
   - –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
   - Health check –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–∑–∞—Å—ã–ø–∞–Ω–∏–µ" –∏–Ω—Å—Ç–∞–Ω—Å–∞

3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
   - –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ Render:

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
```
üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∏ polling:
   ‚Ä¢ polling_timeout: 60 —Å–µ–∫
   ‚Ä¢ session_timeout: 30 —Å–µ–∫
   ‚Ä¢ limit: 100 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∑–∞ –∑–∞–ø—Ä–æ—Å

‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ Render:
   ‚Ä¢ Long polling —Å —Ç–∞–π–º–∞—É—Ç–æ–º 60 —Å–µ–∫—É–Ω–¥
   ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π > 5 –º–∏–Ω—É—Ç
   ‚Ä¢ –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
   ‚Ä¢ Health check endpoint: /health
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check:

```bash
curl https://your-app.onrender.com/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: `{"status": "ok", "service": "tower-bot-telegram"}`

### 3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É:

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ–∫—É–Ω–¥.

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ:
- **`–ù–ê–°–¢–†–û–ô–ö–ò_POLLING_RENDER.md`** - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

---

## üîÑ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. **–ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git add bot.py –ù–ê–°–¢–†–û–ô–ö–ò_POLLING_RENDER.md –£–õ–£–ß–®–ï–ù–ò–Ø_POLLING.md
   git commit -m "–£–ª—É—á—à–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ polling –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ Render"
   git push
   ```

2. **–î–æ–∂–¥–∏—Ç–µ—Å—å –¥–µ–ø–ª–æ—è –Ω–∞ Render:**
   - Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ Render —Ä–∞–∑ –≤ –¥–µ–Ω—å
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check endpoint

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `bot.py`:

**–î–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –æ—Ç–≤–µ—Ç–∞:**
```python
polling_timeout = 20  # –í–º–µ—Å—Ç–æ 60 (–Ω–æ –Ω–µ –º–µ–Ω—å—à–µ 10!)
```

**–î–ª—è –±–æ–ª—å—à–µ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:**
```python
polling_timeout = 90  # –í–º–µ—Å—Ç–æ 60
no_updates_timeout = 600  # 10 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 5
```

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
1. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –Ω–∞ Render
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

---

## üÜò –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ Render** - –Ω–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** - —Å–º. —Ä–∞–∑–¥–µ–ª –≤—ã—à–µ
4. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø–æ–º–æ—â—å—é** - –º–µ–Ω–µ–¥–∂–µ—Ä: @nomep999

---

**–î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:** 2024
**–í–µ—Ä—Å–∏—è aiogram:** 3.13.0+
